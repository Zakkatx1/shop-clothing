{% extends 'someapp/base.html' %}
{% load static %}

{% block title %}Каталог товаров{% endblock %}

{% block content %}
<div class="search-section">
    <form method="get" class="search-form">
        <input type="text" name="q" placeholder="Поиск по названию..." class="search-input" value="{{ request.GET.q }}">
        <button type="submit" class="btn">
            <i class="fas fa-search"></i> Найти
        </button>
    </form>

    <div class="category-filter">
        <a href="{% url 'product_list' %}" class="category-btn {% if not selected_category %}active{% endif %}">
            Все товары
        </a>
        {% for category in categories %}
            <a href="?category={{ category.slug }}" class="category-btn {% if selected_category == category.slug %}active{% endif %}">
                {{ category.name }}
            </a>
        {% endfor %}
    </div>
</div>

{% if page_obj %}
    <div class="products-grid">
        {% for product in page_obj %}
        <div class="product-card">
            {% if product.image %}
                <img src="{{ product.image.url }}" alt="{{ product.name }}" class="product-image">
            {% else %}
                <img src="{% static 'images/placeholder.jpg' %}" alt="Нет изображения" class="product-image">
            {% endif %}
            
            <div class="product-info">
                <h3 class="product-title">{{ product.name }}</h3>
                <p class="product-price">{{ product.price }} ₽</p>
                
                <div class="product-details">
                    <span>{{ product.size }}</span>
                    <span>{{ product.color }}</span>
                    <span>{{ product.category.name }}</span>
                </div>
                
                <a href="{% url 'product_detail' product.pk %}" class="btn btn-view">
                    <i class="fas fa-eye"></i> Подробнее
                </a>
            </div>
        </div>
        {% endfor %}
    </div>

    {% if page_obj.has_other_pages %}
    <div class="pagination">
        {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}" class="page-btn">
                <i class="fas fa-chevron-left"></i>
            </a>
        {% endif %}
        
        {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
                <span class="page-btn active">{{ num }}</span>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                <a href="?page={{ num }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}" class="page-btn">
                    {{ num }}
                </a>
            {% endif %}
        {% endfor %}
        
        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}" class="page-btn">
                <i class="fas fa-chevron-right"></i>
            </a>
        {% endif %}
    </div>
    {% endif %}
{% else %}
    <div class="empty-state">
        <i class="fas fa-search fa-3x" style="color: #667eea; margin-bottom: 20px;"></i>
        <h3>Товары не найдены</h3>
        <p>Попробуйте изменить параметры поиска</p>
        <a href="{% url 'product_list' %}" class="btn">Сбросить фильтры</a>
    </div>
{% endif %}
{% endblock %}